var base_url=$('input[name="base_url"]').val();function usersTable(){$("#tbl_users").DataTable({processing:!0,serverSide:!0,responsive:!0,destroy:!0,order:[[0,"desc"]],columns:[{data:"fullname",width:"15%"},{data:"username",width:"10%"},{data:"office",width:"10%"},{data:"division",width:"15%"},{data:"phone",width:"10%"},{data:"user_type",width:"10%",render:function(data,type,row,meta){var str="";return 1==row.user_type?str+='<span class="label label-success">Admin</span>':2==row.user_type?str+='<span class="label label-info">Manager</span>':str+='<span class="label label-warning">User</span>',str}},{data:"user_status",width:"10%",render:function(data,type,row,meta){var str="";return 1==row.user_status?str+='<span class="label label-success">Active</span>':2==row.user_status?str+='<span class="label label-warning">Deactivated</span>':str+='<span class="label label-danger">For Approval</span>',str}},{data:"user_id",width:"25%",render:function(data,type,row,meta){var str="";return 1==row.user_status?str+='<button data-id="'+row.user_id+'" data-status="'+row.user_status+'" class="btn btn-sm btn-outline-dark updateUserStatus" title="Click to enable"><i class="fa fa-lock"></i> Deactivate</button>&nbsp;':3==row.user_status?str+='<button data-id="'+row.user_id+'" data-status="'+row.user_status+'" class="btn btn-sm btn-outline-info updateUserStatus" title="Click to approve"><i class="fa fa-check"></i> Approve</button>&nbsp;':2==row.user_status&&(str+='<button data-id="'+row.user_id+'" data-status="'+row.user_status+'" class="btn btn-sm btn-outline-success updateUserStatus" title="Click to disable"><i class="fa fa-unlock"></i> Activate</button>&nbsp;'),str+='<button data-toggle="modal" data-target="#modal_updateUser" data-id="'+row.user_id+'" class="btn btn-sm btn-outline-warning updateUser" title="Click to update"><i class="fa fa-edit"></i> Edit</button>&nbsp;',str+='<button data-id="'+row.user_id+'" class="btn btn-sm btn-outline-danger removeUser" title="Click to remove"><i class="fa fa-times-circle"></i> Remove</button>'}}],language:{search:"",searchPlaceholder:"Search keyword...",infoFiltered:""},ajax:{url:base_url+"users/getUsersList",type:"POST"},columnDefs:[{targets:[6],orderable:!1}]})}function sendAjax(param={},isReturn=!0){if(!1===isReturn){var return_response=null;return $.ajax({url:param.url,type:"post",data:param.data,async:!1,processData:!1,contentType:!1,dataType:"json",beforeSend:function(){$(".overlay").show()},success:function(response){$(".overlay").hide(),console.log(response),return_response=response},error:function(e){console.log(e)}}),return_response}var return_data=null;if($.ajax({url:param.url,type:"post",data:param.data,async:!1,dataType:"json",success:function(response){return_data=response},error:function(e){console.log(e)}}),isReturn)return return_data}function confirm_swal(text,confirmBtnText){var isSuccess=!1;return new Promise((function(resolve,reject){Swal.fire({title:"Are you sure?",text:text,type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:confirmBtnText}).then(result=>{result.value?resolve(!0):resolve(!1)})}))}function swal(content,response="success"){"success"==response?Swal.fire("Success",content,response):Swal.fire("Error",content,response)}function clearError(){$(".err").html("")}function input(element,value){$(element).val(value)}$(document).ready((function(){usersTable(),$(document).on("click",".addUser",(function(e){e.preventDefault()})),$(document).on("submit",".form_addUser",(function(e){e.preventDefault();var form_data=new FormData($(".form_addUser")[0]),sendAjaxVar=sendAjax({url:base_url+"users/addManager",data:form_data},!1);sendAjaxVar&&(clearError(),"success"==sendAjaxVar.status?(swal(sendAjaxVar.msg,sendAjaxVar.status),$(".form_addUser")[0].reset(),usersTable(),$("#modal_addManager").modal("toggle")):$.each(sendAjaxVar,(function(key,value){$('input[name="'+key+'"]').next(".err").html(value),$('textarea[name="'+key+'"]').next(".err").html(value),$('select[name="'+key+'"]').next(".err").html(value)})))})),$(document).on("click",".updateUserStatus",(function(){var user_id=$(this).data("id"),user_status=$(this).data("status");1==user_status?confirm_swal("Deactivate this User?","Deactivate").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"users/userStatus",data:{user_id:user_id,user_status:user_status}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),usersTable())}})):confirm_swal("Activate this User?","Activate").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"users/userStatus",data:{user_id:user_id,user_status:user_status}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),usersTable())}}))})),$(document).on("click",".removeUser",(function(e){e.preventDefault();var user_id=$(this).data("id");confirm_swal("Are you sure you want to remove this User?","Remove").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"users/removeUser",data:{user_id:user_id}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.type),usersTable())}}))})),$(document).on("click",".updateUser",(function(){user_id=$(this).data("id");var data=sendAjax({url:base_url+"users/getUserInfo",data:{user_id:user_id}});$(".form_updateUser")[0].reset(),input('input[name="user_id"]',user_id),input('input[name="username"]',data.username),input('input[name="user_type"]',data.user_type),input('input[name="email"]',data.email),input('input[name="firstname"]',data.firstname),input('input[name="middlename"]',data.middlename),input('input[name="lastname"]',data.lastname),input('input[name="phone"]',data.phone),input('input[name="address"]',data.address),input('input[name="office"]',data.office),input('input[name="division"]',data.division),$(".form_addUser")[0].reset()})),$(document).on("submit",".form_updateUser",(function(e){e.preventDefault();var form_data=new FormData($(".form_updateUser")[0]),sendAjaxVar=sendAjax({url:base_url+"users/updateUser",data:form_data},!1);sendAjaxVar&&(clearError(),"success"==sendAjaxVar.status?(swal(sendAjaxVar.msg,sendAjaxVar.status),$(".form_updateUser")[0].reset(),usersTable(),$("#modal_updateUser").modal("toggle")):$.each(sendAjaxVar,(function(key,value){$('input[name="'+key+'"]').next(".err").html(value),$('textarea[name="'+key+'"]').next(".err").html(value),$('select[name="'+key+'"]').next(".err").html(value)})))}))}));