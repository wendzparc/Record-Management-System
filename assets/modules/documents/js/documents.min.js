var base_url=$('input[name="base_url"]').val(),method=$('input[name="basemethod"]').val();function documentTable(division="All",category=""){$("#tbl_documents").DataTable({processing:!0,serverSide:!0,responsive:!0,destroy:!0,order:[[0,"desc"]],columns:[{data:"file_name",width:"20%"},{data:"file_division",width:"10%"},{data:"file_type",width:"10%"},{data:"date_added",width:"10%"},{data:"file_id",width:"25%",render:function(data,type,row,meta){var str="";return str+='<a href="javascript:void(0);" data-barpath="'+base_url+row.barcode_path+'" class="btn btn-sm btn-outline-success barcodeImage" title="Click to View Barcode"><i class="fa fa-eye"></i> Barcode</a>&nbsp;',str+='<a href="'+base_url+row.file_path+'" target="_blank" class="btn btn-sm btn-outline-success downloadDoc" title="Click to download"><i class="fa fa-download"></i> Download</a>&nbsp;',str+='<button data-id="'+row.file_id+'" data-path="'+row.file_path+'" data-barpath="'+row.barcode_path+'" class="btn btn-sm btn-outline-danger removeDocument" title="Click to remove"><i class="fa fa-times-circle"></i> Remove</button>'}}],language:{search:"",searchPlaceholder:"Search keyword...",infoFiltered:""},ajax:{url:base_url+"documents/getDocumentList",type:"POST",data:{division:division,category:category}},columnDefs:[{targets:[4],orderable:!1}]})}function sendAjax(param={},isReturn=!0){if(!1===isReturn){var return_response=null;return $.ajax({url:param.url,type:"post",data:param.data,async:!1,processData:!1,contentType:!1,dataType:"json",beforeSend:function(){$(".overlay").show()},success:function(response){$(".overlay").hide(),return_response=response},error:function(e){console.log(e)}}),return_response}var return_data=null;if($.ajax({url:param.url,type:"post",data:param.data,async:!1,dataType:"json",success:function(response){return_data=response},error:function(e){console.log(e)}}),isReturn)return return_data}function confirm_swal(text,confirmBtnText){var isSuccess=!1;return new Promise((function(resolve,reject){Swal.fire({title:"Are you sure?",text:text,type:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:confirmBtnText}).then(result=>{result.value?resolve(!0):resolve(!1)})}))}function swal(content,response="success"){"success"==response?Swal.fire("Success",content,response):Swal.fire("Error",content,response)}function clearError(){$(".err").html("")}function input(element,value){$(element).val(value)}$(document).ready((function(){"scanbarcode"==method?setInterval((function(){var focusbox;(focusbox=$(".barcodeInput")[0]).focus()})):documentTable(),$(document).on("click",".addDocument",(function(e){e.preventDefault()})),$(".docfile").change((function(){for(var error_file="",files=$(".docfile")[0].files,i=0;i<files.length;i++){var name,ext=$(this)[0].files[i].name.split(".").pop().toLowerCase(),oFReader;-1==$.inArray(ext,["zip","png","jpg","jpeg","png","pdf","docx","doc","xlsx","xls"])&&(error_file+="<p>Invalid file type</p>"),(new FileReader).readAsDataURL($(this)[0].files[i]);var f=$(this)[0].files[i],fsize=f.size||f.fileSize;console.log(fsize),fsize>92309291091&&(error_file+="<p> Document file size is too big to upload </p>")}if(""!=error_file)return ctr+=1,$(".docfile").val(""),$(".docfile").next(".err").html(error_file),!1;ctr=0,$(".docfile").next(".err").html("")})),$(document).on("submit",".form_addDocument",(function(e){e.preventDefault();var form_data=new FormData($(".form_addDocument")[0]);form_data.append("docfile",$("#docfile")[0].files);var sendAjaxVar=sendAjax({url:base_url+"documents/addDocument",data:form_data},!1);sendAjaxVar&&(clearError(),"success"==sendAjaxVar.status?(swal(sendAjaxVar.msg,sendAjaxVar.status),$(".form_addDocument")[0].reset(),documentTable(),$("#modal_addDocument").modal("toggle")):$.each(sendAjaxVar,(function(key,value){$('input[name="'+key+'"]').next(".err").html(value),$('textarea[name="'+key+'"]').next(".err").html(value),$('select[name="'+key+'"]').next(".err").html(value)})))})),$(document).on("click",".removeDocument",(function(e){e.preventDefault();var file_id=$(this).data("id"),file_path=$(this).data("path"),barcode_path=$(this).data("barpath");confirm_swal("Are you sure you want to remove this Document?","Remove").then((function(val){if(!0===val){const sendAjaxVar=sendAjax({url:base_url+"documents/removeDocument",data:{file_id:file_id,file_path:file_path,barcode_path:barcode_path}});sendAjaxVar&&(swal(sendAjaxVar.msg,sendAjaxVar.status),documentTable())}}))})),$(document).on("click",".barcodeImage",(function(e){e.preventDefault();var barcode=$(this).data("barpath"),win=window.open("about:blank","_new");win.document.open(),win.document.write(["<html>","   <head>","   </head>",'   <body onload="window.print()" onafterprint="window.close()">','       <img src="'+barcode+'"/>',"   </body>","</html>"].join("")),win.document.close()})),$(document).on("change",".division",(function(e){let val=$(this).find(":selected").val(),gen=["Gawad Kalasag","Minutes of the Meeting","MDRRMC Resolutions & Guidelines","Seal of Good Local Governance","Awards and Certificates","Others"],adminfinance=["Travel Orders","Purchase Orders","PPMP","Attendance","Payroll","Others"],training=["Activity Proposals","Meetings","Post Activity Reports","Documentation","Training Manuals","Certificates","Others"],operations=["Activities","Documentations","Reports"];var html='<div class="col-md-6 categDiv">\n                        <div class="form-group">';"General"==val?(html+='<label for="category" class="control-label">Category</label>\n                            <select name="category" class="form-control category">\n                            <option value="" selected hidden> - Please Select - </option>',$.each(gen,(function(key,value){html+='<option value="'+value+'">'+value+"</option>"})),html+="</select>"):"Admin & Finance"==val?(html+='<label for="category" class="control-label">Category</label>\n                            <select name="category" class="form-control divCategory">\n                            <option value="" selected hidden> - Please Select - </option>',$.each(adminfinance,(function(key,value){html+='<option value="'+value+'">'+value+"</option>"})),html+="</select>"):"Training & Planning"==val?(html+='<label for="category" class="control-label">Category</label>\n                            <select name="category" class="form-control category">\n                            <option value="" selected hidden> - Please Select - </option>',$.each(training,(function(key,value){html+='<option value="'+value+'">'+value+"</option>"})),html+="</select>"):(html+='<label for="category" class="control-label">Category</label>\n                            <select name="category" class="form-control category">\n                            <option value="" selected hidden> - Please Select - </option>',$.each(operations,(function(key,value){html+='<option value="'+value+'">'+value+"</option>"})),html+="</select>"),html+='<small class="err"></small>\n                    </div>\n                </div>\n                <div class="col-md-6 othersDiv"></div>\n                <div class="col-md-6 repOthersDiv"></div>',$(".divContainer").html(html)})),$(document).on("change",".category",(function(e){let val=$(this).find(":selected").val(),reports=["Incident Reports","SitRep","Responders Logbook","PDRA","PDNA","RDNA","Relief Operations","CCCM Reports","Others"];var html="";"Reports"==val?(html+='<div class="form-group">\n                        <label for="reports" class="control-label">Reports</label>\n                        <select name="reports" class="form-control reports">\n                        <option value="" selected hidden> - Please Select - </option>',$.each(reports,(function(key,value){html+='<option value="'+value+'">'+value+"</option>"})),html+='</select>\n                        <small class="err"></small>\n                    </div>'):html+="Others"==val?'<div class="form-group">\n                        <label for="reports" class="control-label">Others</label>\n                        <input type="text" class="form-control" name="others" placeholder="Enter Other Category">\n                        <small class="err"></small>\n                    </div>':"",$(".othersDiv").html(html)})),$(document).on("change",".reports",(function(e){let val;var html="";html+="Others"==$(this).find(":selected").val()?'<div class="form-group">\n                        <label for="reports" class="control-label">Others</label>\n                        <input type="text" class="form-control" name="others" placeholder="Enter Other Category">\n                        <small class="err"></small>\n                    </div>':"",$(".repOthersDiv").html(html)})),$(document).on("keyup",".barcodeInput",(function(){barcode=$(this).val();var html="",data=sendAjax({url:base_url+"documents/fetchBarcodeScan",data:{barcode:barcode}});clearError(),html+=data?'<div class="col-md-12">\n                <div class="form-group">\n                <a href="'+base_url+data.file_path+'" target="_blank"><img src="'+base_url+'/assets/build/images/avatar.gif" class="scanImage"></a>\n                <p class="scanDivision">'+data.file_division+'</p>\n                <p class="scanType">'+data.file_type+'</p>\n                <p class="scanTitle">'+data.file_name+"</p>\n                </div>\n            </div>":"",$(".scanResult").html(html)})),$(document).on("click",".filterBtn",(function(){var division,category;documentTable($(".byDivision").val(),$(".byCategory").val())}))}));